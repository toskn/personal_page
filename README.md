# Active learning markup tool for NER

Инструмент для разметки корпуса с активным обучением seq2seq модели.

## Запуск скрипта

```
python start_training.py [--arg1 val1 --arg2 val2 ...]
```

Возможные аргументы:

- **- -pretrained path/filename**
	
	Путь до предобученной модели.
	
	По пути path должны лежать *filename.json*, *filename.h5*, *filename.pkl* 


- **- -marked**
	
	(default) - *data/marked*

	Путь до директори с рамеченными файлами в формате conllu


- **- -unmarked**
	
	(default) - *data/unmarked*

	Путь до директори с нерамеченными файлами в формате conllu


- **- -wordemb**
	
	(default) - *../fasttext/model.model*

	Путь до эмбеддингов. Ссылка для [скачки](http://vectors.nlpl.eu/repository/11/187.zip)

	**Внимание** - из архива нужно распаковать все файлы, а не только *.model 


- **- -logdir**
	
	(default) - *log*

	Директория для логов. 


- **- -mmarkup**
	
	(default) - *manual_markup*
	
	Директория, в которую будет сохранена промежуточная разметка в файле *.markup. О формате - ниже


- **- -before**
	
	(default) - *0*

	Сколько эпох тренировать модель перед первой итерацией разметки


- **-c**
	
	(default) - *False*

	Принудительно обучить чистую модель. Используйте с параметром --before.
	Обученная модель будет сохранена в директорию *log*


## Пайплайн разметки

Этапы разметки следующие:

1. Все файлы из директорий marked и unmarked преобразуются предобученной моделью 
2. Если есть **- -before**, модель предобучается
3. Модель обучается на размеченной части датасета
4. Подсчитывается энтропия, на основании которой выбираются 40 предложений, в которых модель наиболее уверена и 10 в которых наименее.
5. Предлогается в интерактивном режиме в консоли отобрать правильно/неправильно размеченные предложения.
6. В **mmarkup** директорию кладется файл с разметкой в следующем формате:
   ```
   fidx_0 sent_num_0 sent_len_0
   label_0\tword_0
   label_1\tword_1
   label_2\tword_2
   ...
   label_n\tword_n
   fidx_1 sent_num_1 sent_len_1
   ...
   ```
7. Разметьте **.markup* файл
8. Подтвердите это в консоли.
9. Файл разметки подгружается. Если один из неразмеченных файлов был размечен полностью, то он переписывается с новой разметкой в формате conllu в директорию *marked/by_model*. Размеченная часть добавляется в размеченную часть датасета 
10. GOTO шаг 3.
